<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture — openrappter</title>
  <meta name="description" content="How openrappter works under the hood: agent contract, data sloshing, execution flow, multi-agent orchestration, and directory structure.">
  <meta property="og:title" content="Architecture — openrappter">
  <meta property="og:description" content="How openrappter works under the hood: agent contract, data sloshing, execution flow, multi-agent orchestration, and directory structure.">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<!-- ── Navbar ── -->
<nav>
  <div class="nav-container">
    <a href="./" class="logo">openrappter <span class="logo-badge">v1.4.1</span></a>
    <button class="mobile-menu-btn">&#9776;</button>
    <div class="nav-links">
      <a href="./docs.html">Docs</a>
      <a href="./architecture.html">Architecture</a>
      <a href="./tutorial.html">Tutorial</a>
      <a href="./changelog.html">Changelog</a>
    </div>
    <div class="nav-cta">
      <a href="https://github.com/kody-w/openrappter" class="btn btn-ghost">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
        GitHub
      </a>
    </div>
  </div>
</nav>

<!-- ── Hero ── -->
<section class="hero">
  <div class="hero-bg"></div>
  <h1 style="background:linear-gradient(135deg,var(--text) 0%,var(--green-bright) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">Architecture</h1>
  <p class="hero-subtitle">How openrappter works under the hood</p>
</section>

<!-- ── 1. System Overview ── -->
<section class="doc-section" id="system-overview" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">System Overview</div>
  <h2 class="section-title">Architecture at a glance</h2>
  <p class="section-subtitle">openrappter is a layered, local-first AI agent framework. Channels funnel messages into a WebSocket gateway, which dispatches them through a registry of agents. Those agents talk to pluggable LLM providers, a hybrid memory system, and a persistent storage layer — all on your own machine.</p>

  <div class="arch-diagram">                     Channels
    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9436;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9436;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9436;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
    &#9474;   CLI   &#9474;  Slack   &#9474;  Discord  &#9474; Telegram &#9474;  ...15+ more
    &#9492;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
         &#9474;         &#9474;           &#9474;          &#9474;
         &#9660;         &#9660;           &#9660;          &#9660;
    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
    &#9474;           WebSocket Gateway               &#9474;
    &#9474;        (JSON-RPC 2.0 / Streaming)         &#9474;
    &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                       &#9474;
                       &#9660;
    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
    &#9474;           Agent Registry                  &#9474;
    &#9474;   &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488; &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9474;
    &#9474;   &#9474;Shell &#9474; &#9474;Memory&#9474; &#9474; Web  &#9474; &#9474;Browser&#9474;  &#9474;
    &#9474;   &#9474;Agent &#9474; &#9474;Agent &#9474; &#9474;Agent &#9474; &#9474; Agent &#9474;  &#9474;
    &#9474;   &#9492;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496; &#9492;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496; &#9492;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496; &#9492;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496;  &#9474;
    &#9474;      &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;       &#9474;
    &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                       &#9474;
         &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9532;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
         &#9660;             &#9660;             &#9660;
    &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
    &#9474;Providers&#9474;  &#9474;  Memory  &#9474;  &#9474; Storage  &#9474;
    &#9474; Copilot &#9474;  &#9474; Chunker  &#9474;  &#9474;  SQLite  &#9474;
    &#9474;Anthropic&#9474;  &#9474;Embeddings&#9474;  &#9474;In-Memory &#9474;
    &#9474; OpenAI  &#9474;  &#9474;  Search  &#9474;  &#9474;          &#9474;
    &#9474; Gemini  &#9474;  &#9474;          &#9474;  &#9474;          &#9474;
    &#9474; Ollama  &#9474;  &#9474;          &#9474;  &#9474;          &#9474;
    &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;</div>
</section>

<!-- ── 2. Agent Contract ── -->
<section class="doc-section" id="agent-contract" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Agent Contract</div>
  <h2 class="section-title">One file = one agent</h2>
  <p class="section-subtitle">Every agent is a single file. The metadata contract, documentation, and deterministic logic all live together using native language constructs — Python dicts or TypeScript objects. No YAML. No config files. No magic parsing. The code IS the contract.</p>

  <p style="color:var(--text-secondary);margin-bottom:1.5rem;font-size:0.95rem;line-height:1.7;">Three rules apply to every agent:</p>
  <ul style="color:var(--text-secondary);margin:0 0 2rem 1.5rem;font-size:0.95rem;line-height:1.9;">
    <li>Metadata lives in the constructor — name, description, and JSON Schema parameters are declared once in native code.</li>
    <li><code>perform()</code> is the abstract method subclasses implement. It receives <code>kwargs</code>, returns a JSON string, and runs deterministically.</li>
    <li>Return JSON with an optional <code>data_slush</code> key to pass curated signals to downstream agents in a chain.</li>
  </ul>

  <div class="code-tabs">
    <div class="code-tabs-header">
      <button class="code-tab-btn active" onclick="switchTab(this, 'ts-contract')">TypeScript</button>
      <button class="code-tab-btn" onclick="switchTab(this, 'py-contract')">Python</button>
    </div>
    <div class="code-tab-content active" id="ts-contract">
      <pre><span class="kw">export class</span> <span class="typ">WeatherAgent</span> <span class="kw">extends</span> BasicAgent {
  <span class="fn">constructor</span>() {
    <span class="kw">const</span> metadata: <span class="typ">AgentMetadata</span> = {
      name: <span class="str">'WeatherAgent'</span>,
      description: <span class="str">'Fetches current weather'</span>,
      parameters: {
        type: <span class="str">'object'</span>,
        properties: {
          city: { type: <span class="str">'string'</span>, description: <span class="str">'City name'</span> }
        },
        required: [<span class="str">'city'</span>]
      }
    };
    <span class="fn">super</span>(<span class="str">'WeatherAgent'</span>, metadata);
  }

  <span class="kw">async</span> <span class="fn">perform</span>(kwargs: <span class="typ">Record</span>&lt;<span class="typ">string</span>, <span class="typ">unknown</span>&gt;) {
    <span class="kw">const</span> city = kwargs.city <span class="kw">as</span> <span class="typ">string</span>;
    <span class="cm">// ... fetch weather ...</span>
    <span class="kw">return</span> JSON.stringify({ temperature: <span class="val">72</span>, condition: <span class="str">'sunny'</span>, city });
  }
}</pre>
    </div>
    <div class="code-tab-content" id="py-contract">
      <pre><span class="kw">class</span> <span class="typ">WeatherAgent</span>(BasicAgent):
    <span class="kw">def</span> <span class="fn">__init__</span>(self):
        self.name = <span class="str">'WeatherAgent'</span>
        self.metadata = {
            <span class="str">"name"</span>: self.name,
            <span class="str">"description"</span>: <span class="str">"Fetches current weather"</span>,
            <span class="str">"parameters"</span>: {
                <span class="str">"type"</span>: <span class="str">"object"</span>,
                <span class="str">"properties"</span>: {
                    <span class="str">"city"</span>: {<span class="str">"type"</span>: <span class="str">"string"</span>, <span class="str">"description"</span>: <span class="str">"City name"</span>}
                },
                <span class="str">"required"</span>: [<span class="str">"city"</span>]
            }
        }
        <span class="fn">super</span>().__init__(name=self.name, metadata=self.metadata)

    <span class="kw">def</span> <span class="fn">perform</span>(self, **kwargs):
        city = kwargs.get(<span class="str">'city'</span>)
        <span class="cm"># ... fetch weather ...</span>
        <span class="kw">return</span> json.dumps({<span class="str">"temperature"</span>: <span class="val">72</span>, <span class="str">"condition"</span>: <span class="str">"sunny"</span>, <span class="str">"city"</span>: city})</pre>
    </div>
  </div>
</section>

<!-- ── 3. Data Sloshing ── -->
<section class="doc-section" id="data-sloshing" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Data Sloshing</div>
  <h2 class="section-title">Implicit context enrichment</h2>
  <p class="section-subtitle">Before every agent action, openrappter automatically enriches the call with temporal awareness, memory echoes, query signals, and behavioral hints. Agents never run "blind" — they always have orientation context synthesized from all available signals.</p>

  <p style="color:var(--text-secondary);margin-bottom:1.5rem;font-size:0.95rem;line-height:1.7;">The sloshing pipeline gathers signals across five categories and synthesizes them into an <strong>Orientation</strong> — a confidence score, recommended approach, and contextual hints — before your <code>perform()</code> runs.</p>

  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(270px,1fr));gap:1.25rem;margin:2rem 0;">
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
      <h4 style="font-size:0.95rem;font-weight:700;margin-bottom:0.75rem;color:var(--text);">Temporal</h4>
      <div style="display:flex;flex-wrap:wrap;gap:0.35rem;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">time_of_day</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">day_of_week</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">is_weekend</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">hour</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">minute</span>
      </div>
    </div>
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
      <h4 style="font-size:0.95rem;font-weight:700;margin-bottom:0.75rem;color:var(--text);">Query</h4>
      <div style="display:flex;flex-wrap:wrap;gap:0.35rem;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">intent</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">entities</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">sentiment</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">complexity</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">keywords</span>
      </div>
    </div>
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
      <h4 style="font-size:0.95rem;font-weight:700;margin-bottom:0.75rem;color:var(--text);">Memory</h4>
      <div style="display:flex;flex-wrap:wrap;gap:0.35rem;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">recent_memories</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">relevant_context</span>
      </div>
    </div>
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
      <h4 style="font-size:0.95rem;font-weight:700;margin-bottom:0.75rem;color:var(--text);">Behavioral</h4>
      <div style="display:flex;flex-wrap:wrap;gap:0.35rem;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">session_duration</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">interaction_count</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">patterns</span>
      </div>
    </div>
    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;">
      <h4 style="font-size:0.95rem;font-weight:700;margin-bottom:0.75rem;color:var(--text);">Orientation <span style="font-size:0.75rem;font-weight:400;color:var(--text-muted);">(synthesized)</span></h4>
      <div style="display:flex;flex-wrap:wrap;gap:0.35rem;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">confidence</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">approach</span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:0.7rem;padding:0.2rem 0.5rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:4px;color:var(--text-muted);">hints</span>
      </div>
    </div>
  </div>

  <p style="color:var(--text-secondary);margin-bottom:1rem;font-size:0.95rem;line-height:1.7;">Access signals via the dot-notation helper in both runtimes:</p>

  <div class="code-tabs">
    <div class="code-tabs-header">
      <button class="code-tab-btn active" onclick="switchTab(this, 'slosh-ts')">TypeScript</button>
      <button class="code-tab-btn" onclick="switchTab(this, 'slosh-py')">Python</button>
    </div>
    <div class="code-tab-content active" id="slosh-ts">
      <pre><span class="kw">async</span> <span class="fn">perform</span>(kwargs: <span class="typ">Record</span>&lt;<span class="typ">string</span>, <span class="typ">unknown</span>&gt;) {
  <span class="cm">// Dot-notation helper — traverses nested context</span>
  <span class="kw">const</span> timeOfDay  = <span class="kw">this</span>.<span class="fn">getSignal</span>(<span class="str">'temporal.time_of_day'</span>);
  <span class="kw">const</span> confidence = <span class="kw">this</span>.<span class="fn">getSignal</span>(<span class="str">'orientation.confidence'</span>);
  <span class="kw">const</span> approach   = <span class="kw">this</span>.<span class="fn">getSignal</span>(<span class="str">'orientation.approach'</span>);

  <span class="cm">// Full context object is also available directly</span>
  <span class="kw">const</span> memories = <span class="kw">this</span>.context?.memory?.recent_memories ?? [];

  <span class="cm">// Upstream slush from a chained agent</span>
  <span class="kw">const</span> upstream = <span class="kw">this</span>.context?.upstream_slush;
  <span class="kw">const</span> prevTemp = upstream?.temp_f;
}</pre>
    </div>
    <div class="code-tab-content" id="slosh-py">
      <pre><span class="kw">def</span> <span class="fn">perform</span>(self, **kwargs):
    <span class="cm"># Dot-notation helper — traverses nested context</span>
    time_of_day  = self.<span class="fn">get_signal</span>(<span class="str">'temporal.time_of_day'</span>)
    confidence   = self.<span class="fn">get_signal</span>(<span class="str">'orientation.confidence'</span>)
    approach     = self.<span class="fn">get_signal</span>(<span class="str">'orientation.approach'</span>)

    <span class="cm"># Full context dict is also available directly</span>
    memories = self.context.get(<span class="str">'memory'</span>, {}).get(<span class="str">'recent_memories'</span>, [])

    <span class="cm"># Upstream slush from a chained agent</span>
    upstream  = self.context.get(<span class="str">'upstream_slush'</span>, {})
    prev_temp = upstream.get(<span class="str">'temp_f'</span>)</pre>
    </div>
  </div>
</section>

<!-- ── 4. Data Slush Pipeline ── -->
<section class="doc-section" id="data-slush" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Data Slush Pipeline</div>
  <h2 class="section-title">Agent-to-agent signal chaining</h2>
  <p class="section-subtitle">After <code>perform()</code> returns, if the result JSON contains a <code>data_slush</code> key, the framework automatically extracts it to <code>lastDataSlush</code> (TypeScript) / <code>last_data_slush</code> (Python). Pass that to the next agent as <code>upstream_slush</code> and it merges into that agent's context — no LLM needed between calls.</p>

  <p style="color:var(--text-secondary);margin-bottom:0.5rem;font-size:0.95rem;line-height:1.7;"><strong>Pipeline flow:</strong> Agent A <code>perform()</code> &#8594; <code>data_slush</code> extracted &#8594; passed as <code>upstream_slush</code> &#8594; Agent B <code>execute()</code> &#8594; merged into Agent B's context.</p>

  <p style="color:var(--text-secondary);margin-bottom:1.5rem;font-size:0.95rem;line-height:1.7;"><strong>Key rules:</strong> <code>data_slush</code> should be curated (not a raw data dump), keys should be descriptive, and <code>source_agent</code> is a recommended convention for traceability.</p>

  <div class="code-tabs">
    <div class="code-tabs-header">
      <button class="code-tab-btn active" onclick="switchTab(this, 'slush-pipeline-ts')">TypeScript</button>
      <button class="code-tab-btn" onclick="switchTab(this, 'slush-pipeline-py')">Python</button>
    </div>
    <div class="code-tab-content active" id="slush-pipeline-ts">
      <pre><span class="cm">// Agent A — curate signals in data_slush</span>
<span class="kw">async</span> <span class="fn">perform</span>(kwargs: <span class="typ">Record</span>&lt;<span class="typ">string</span>, <span class="typ">unknown</span>&gt;) {
  <span class="kw">const</span> weather = <span class="kw">await</span> <span class="fn">fetchWeather</span>(kwargs.city <span class="kw">as</span> <span class="typ">string</span>);
  <span class="kw">return</span> JSON.stringify({
    status: <span class="str">'success'</span>,
    result: weather,
    data_slush: {           <span class="cm">// extracted to lastDataSlush automatically</span>
      source_agent: <span class="kw">this</span>.name,
      temp_f: weather.temperature,
      condition: weather.condition,
    }
  });
}

<span class="cm">// Orchestrator: chain Agent A &#8594; Agent B</span>
<span class="kw">const</span> resultA = <span class="kw">await</span> agentA.<span class="fn">execute</span>({ city: <span class="str">'Atlanta'</span> });
<span class="kw">const</span> resultB = <span class="kw">await</span> agentB.<span class="fn">execute</span>({
  query: <span class="str">'Should I bring a jacket?'</span>,
  upstream_slush: agentA.lastDataSlush,   <span class="cm">// agent B sees temp_f + condition</span>
});</pre>
    </div>
    <div class="code-tab-content" id="slush-pipeline-py">
      <pre><span class="cm"># Agent A — curate signals in data_slush</span>
<span class="kw">def</span> <span class="fn">perform</span>(self, **kwargs):
    weather = fetch_weather(kwargs.get(<span class="str">'city'</span>))
    <span class="kw">return</span> json.dumps({
        <span class="str">"status"</span>: <span class="str">"success"</span>,
        <span class="str">"result"</span>: weather,
        <span class="str">"data_slush"</span>: {          <span class="cm"># extracted to last_data_slush automatically</span>
            <span class="str">"source_agent"</span>: self.name,
            <span class="str">"temp_f"</span>: weather[<span class="str">"temperature"</span>],
            <span class="str">"condition"</span>: weather[<span class="str">"condition"</span>],
        }
    })

<span class="cm"># Orchestrator: chain Agent A &#8594; Agent B</span>
result_a = agent_a.execute(city=<span class="str">'Atlanta'</span>)
result_b = agent_b.execute(
    query=<span class="str">'Should I bring a jacket?'</span>,
    upstream_slush=agent_a.last_data_slush,  <span class="cm"># agent B sees temp_f + condition</span>
)</pre>
    </div>
  </div>
</section>

<!-- ── 5. Execution Flow ── -->
<section class="doc-section" id="execution-flow" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Execution Flow</div>
  <h2 class="section-title">What happens when you call execute()</h2>
  <p class="section-subtitle">Every agent invocation runs the same pipeline: gather implicit context, merge upstream signals, run your deterministic code, then extract output signals for downstream agents.</p>

  <div class="arch-diagram">execute(kwargs)
    &#9474;
    &#9500;&#9472;&#9472;&#9658; slosh(query)          <span class="comment">// gather implicit context</span>
    &#9474;      &#9500;&#9472;&#9472; temporal signals
    &#9474;      &#9500;&#9472;&#9472; query analysis
    &#9474;      &#9500;&#9472;&#9472; memory echoes
    &#9474;      &#9492;&#9472;&#9472; behavioral hints
    &#9474;              &#9474;
    &#9474;              &#9660;
    &#9474;        Orientation
    &#9474;    (confidence, approach, hints)
    &#9474;
    &#9500;&#9472;&#9472;&#9658; merge upstream_slush   <span class="comment">// from previous agent</span>
    &#9474;
    &#9500;&#9472;&#9472;&#9658; perform(kwargs)        <span class="comment">// YOUR code runs here</span>
    &#9474;
    &#9492;&#9472;&#9472;&#9658; extract data_slush     <span class="comment">// for downstream agents</span></div>

  <p style="color:var(--text-secondary);margin-top:1.5rem;font-size:0.95rem;line-height:1.7;">The <code>execute()</code> method is the public entry point and should never be overridden. Subclasses implement only <code>perform()</code>. This separation guarantees that sloshing, upstream merging, and slush extraction always run regardless of which agent is invoked.</p>
</section>

<!-- ── 6. Multi-Agent Orchestration ── -->
<section class="doc-section" id="multi-agent" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Multi-Agent Orchestration</div>
  <h2 class="section-title">Broadcast, route, and nest agents</h2>
  <p class="section-subtitle">TypeScript includes three built-in orchestration primitives for coordinating multiple agents: BroadcastManager for fan-out, AgentRouter for rule-based dispatch, and SubAgentManager for nested invocation with depth and loop guards.</p>

  <h3 style="font-size:1.25rem;font-weight:700;margin:2.5rem 0 0.75rem;color:var(--text);">BroadcastManager</h3>
  <p style="color:var(--text-secondary);margin-bottom:1rem;font-size:0.95rem;line-height:1.7;">Send a message to multiple agents simultaneously. Three modes control how results are collected:</p>
  <ul style="color:var(--text-secondary);margin:0 0 1.5rem 1.5rem;font-size:0.95rem;line-height:1.9;">
    <li><strong>all</strong> — wait for every agent to respond, collect all results into an array.</li>
    <li><strong>race</strong> — return the first response that arrives, discard the rest.</li>
    <li><strong>fallback</strong> — try agents sequentially; stop and return on the first success.</li>
  </ul>

  <div class="arch-diagram">         BroadcastManager (all mode)

  broadcast(message)
       &#9474;
       &#9500;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
       &#9474;              &#9474;              &#9474;
       &#9660;              &#9660;              &#9660;
  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;      &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
  &#9474;Agent A&#9474;      &#9474;Agent B&#9474;      &#9474;Agent C&#9474;
  &#9492;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496;      &#9492;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496;      &#9492;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9496;
       &#9474;              &#9474;              &#9474;
       &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
                      &#9474;
               results[A, B, C]</div>

  <h3 style="font-size:1.25rem;font-weight:700;margin:2.5rem 0 0.75rem;color:var(--text);">AgentRouter</h3>
  <p style="color:var(--text-secondary);margin-bottom:1rem;font-size:0.95rem;line-height:1.7;">Rule-based routing dispatches messages to specific agents based on match criteria. Rules are evaluated in priority order, and session key isolation prevents context bleed between different callers.</p>
  <ul style="color:var(--text-secondary);margin:0 0 1.5rem 1.5rem;font-size:0.95rem;line-height:1.9;">
    <li><strong>Match criteria:</strong> sender identity, channel name, group membership, regex pattern against message content.</li>
    <li><strong>Priority ordering:</strong> rules with lower priority numbers run first, providing deterministic dispatch order.</li>
    <li><strong>Session key isolation:</strong> each unique session key gets its own context, preventing cross-request interference.</li>
  </ul>

  <div class="arch-diagram">         AgentRouter

  incoming message
       &#9474;
       &#9660;
  &#9484;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9488;
  &#9474; Rule matching &#9474;
  &#9474; (by priority) &#9474;
  &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9508;&#9472;&#9472;&#9472;&#9472;&#9472;&#9496;
       &#9474;
       &#9500;&#9472; sender == "alice"    &#9658; CustomerAgent
       &#9500;&#9472; channel == "billing" &#9658; BillingAgent
       &#9500;&#9472; /^deploy/i            &#9658; DeployAgent
       &#9492;&#9472; (default)             &#9658; FallbackAgent</div>

  <h3 style="font-size:1.25rem;font-weight:700;margin:2.5rem 0 0.75rem;color:var(--text);">SubAgentManager</h3>
  <p style="color:var(--text-secondary);margin-bottom:1rem;font-size:0.95rem;line-height:1.7;">Enables agents to invoke other agents recursively. Two guard mechanisms prevent runaway recursion:</p>
  <ul style="color:var(--text-secondary);margin:0 0 1.5rem 1.5rem;font-size:0.95rem;line-height:1.9;">
    <li><strong>Depth limits:</strong> a configurable maximum nesting depth (default: 5) halts the call chain before it recurses indefinitely.</li>
    <li><strong>Loop detection:</strong> a breadcrumb trail of agent names is passed through the context; invoking an agent already in the trail is rejected immediately.</li>
  </ul>

  <div class="arch-diagram">         SubAgentManager

  AgentA.perform()
       &#9474;
       &#9492;&#9472;&#9658; subAgent.invoke(AgentB, depth=1)
                  &#9474;
                  &#9492;&#9472;&#9658; subAgent.invoke(AgentC, depth=2)
                             &#9474;
                             &#9492;&#9472;&#9658; depth check / loop check
                                        &#9474;
                                   AgentC.execute()
                                        &#9474;
                                      result &#8593;
                             result propagates up</div>
</section>

<!-- ── 7. Directory Structure ── -->
<section class="doc-section" id="directory-structure" style="max-width:1100px;margin:0 auto;padding:3rem 2rem;">
  <div class="section-label">Directory Structure</div>
  <h2 class="section-title">Monorepo layout</h2>
  <p class="section-subtitle">TypeScript and Python share the same repo. The agent contract is identical across both runtimes. Drop a new agent file in the appropriate <code>agents/</code> directory and the registry discovers it automatically.</p>

  <pre style="background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:2rem;font-family:'JetBrains Mono',monospace;font-size:0.82rem;line-height:1.9;overflow-x:auto;margin-top:2rem;"><span style="color:var(--blue);">openrappter/</span>
<span style="color:var(--border-light);">&#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">typescript/</span>
<span style="color:var(--border-light);">&#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">src/</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">agents/</span>         <span style="color:#525252;"># All agent implementations</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">channels/</span>       <span style="color:#525252;"># 15+ messaging channels</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">providers/</span>      <span style="color:#525252;"># LLM provider integrations</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">gateway/</span>        <span style="color:#525252;"># WebSocket server</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">memory/</span>         <span style="color:#525252;"># Chunking, embeddings, search</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">storage/</span>        <span style="color:#525252;"># SQLite + in-memory adapters</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">config/</span>         <span style="color:#525252;"># YAML/JSON config + Zod</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--text-muted);">clawhub.ts</span>      <span style="color:#525252;"># ClawHub client</span>
<span style="color:var(--border-light);">&#9474;   &#9474;   &#9492;&#9472;&#9472;</span> <span style="color:var(--blue);">skills/</span>         <span style="color:#525252;"># Skill registry</span>
<span style="color:var(--border-light);">&#9474;   &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">dist/</span>               <span style="color:#525252;"># Compiled output</span>
<span style="color:var(--border-light);">&#9474;   &#9492;&#9472;&#9472;</span> <span style="color:var(--text-muted);">package.json</span>
<span style="color:var(--border-light);">&#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">python/</span>
<span style="color:var(--border-light);">&#9474;   &#9492;&#9472;&#9472;</span> <span style="color:var(--blue);">openrappter/</span>
<span style="color:var(--border-light);">&#9474;       &#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">agents/</span>         <span style="color:#525252;"># Python agent mirror</span>
<span style="color:var(--border-light);">&#9474;       &#9492;&#9472;&#9472;</span> <span style="color:var(--text-muted);">clawhub.py</span>      <span style="color:#525252;"># ClawHub client</span>
<span style="color:var(--border-light);">&#9500;&#9472;&#9472;</span> <span style="color:var(--blue);">docs/</span>                   <span style="color:#525252;"># GitHub Pages site</span>
<span style="color:var(--border-light);">&#9492;&#9472;&#9472;</span> <span style="color:var(--text-muted);">CLAUDE.md</span>               <span style="color:#525252;"># Agent architecture guide</span></pre>
</section>

<!-- ── Footer ── -->
<footer>
  <div class="footer-container">
    <div class="footer-links">
      <a href="https://github.com/kody-w/openrappter">GitHub</a>
      <a href="./docs.html">Docs</a>
      <a href="./tutorial.html">Tutorial</a>
      <a href="./changelog.html">Changelog</a>
    </div>
    <div class="footer-copy">MIT License</div>
  </div>
</footer>

<script src="./nav.js"></script>

</body>
</html>
